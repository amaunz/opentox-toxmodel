- uri = url_for("/model/#{model.id}", :full)
- js = "$('#delete_#{model.id}').deleteModel('DELETE', {elem: '#model_#{model.id}'});\n  " + "$('#show_model_#{model.id}_warnings').toggleWarnings('#{model.id}');"
:javascript
  $(function() {
    #{js}
  });
  
%div{:id => "model_#{model.id}"}  
  %h2
    = model.name
  %dl
    %dt Status:
    %dd
      %span{:id => "model_#{model.id}_status", :class => model.status}
        = haml :model_status, :locals=>{:model=>model}, :layout => false 
      (
      %a{:href => url_for("/model/#{model.id}"), :id => "delete_#{model.id}", :class => 'delete'} delete
      )
    %dt Started:
    %dd= model.created_at.strftime("%m/%d/%Y - %I:%M:%S%p")
    %dt Training compounds:
    %dd= model.nr_compounds
    %dt Warnings:
    - if model.warnings == ''
      %dd -
    - else
      %a{:href => "#", :id => "show_model_#{model.id}_warnings"} show
      %dd{:id => "model_#{model.id}_warnings", :style => "display: none;"}= model.warnings

    - if model.status == 'completed'
      %dt Algorithm:
      %dd
        %a{:href => model.algorithm} #{File.basename model.algorithm}
      %dt Descriptors:
      %dd
        %a{:href => 'http://www.maunz.de/libfminer2-bbrc-doc/'} Fminer backbone refinement classes
      %dt Training dataset:
      %dd
        %a{:href => "#{model.training_dataset}.rdf"} RDF/XML
        ,
        %a{:href => "#{model.training_dataset}.yaml"} YAML
        ,
        %a{:href => "#{model.training_dataset}.xls"} XLS
        %em  (more formats to be added)
      %dt Feature dataset:
      %dd
        %a{:href => "#{model.feature_dataset}.rdf"} RDF/XML
        ,
        %a{:href => "#{model.feature_dataset}.yaml"} YAML
        %em  (more formats to be added)
      %dt Model:
      %dd
        -# %a{:href => model.uri, :accept => "application/x-yaml"} yaml
        %a{:href => "#{model.uri}.rdf"} RDF/XML
        ,
        %a{:href => "#{model.uri}.yaml"} YAML
        %em  (more formats to be added)
      %dt Validation:
        - if model.validation_report_uri
          %a{:href => model.validation_report_uri, :target => "_blank"} (more details)
      %dd
        - if model.validation_uri
          - uri = File.join(model.validation_uri, 'statistics')
          - yaml = RestClient.get(uri).body
          - v = YAML.load(yaml)
          - tp=0; tn=0; fp=0; fn=0; n=0
          - v[:classification_statistics][:confusion_matrix][:confusion_matrix_cell].each do |cell|
            - if cell[:confusion_matrix_predicted] == "true" and cell[:confusion_matrix_actual] == "true"
              - tp = cell[:confusion_matrix_value]
              - n += tp
            - elsif cell[:confusion_matrix_predicted] == "false" and cell[:confusion_matrix_actual] == "false"
              - tn = cell[:confusion_matrix_value]
              - n += tn
            - elsif cell[:confusion_matrix_predicted] == "false" and cell[:confusion_matrix_actual] == "true"
              - fn = cell[:confusion_matrix_value]
              - n += fn
            - elsif cell[:confusion_matrix_predicted] == "true" and cell[:confusion_matrix_actual] == "false"
              - fp = cell[:confusion_matrix_value]
              - n += fp


          -#%pre
            = yaml
          %dl
            %dt Number of predictions:
            %dd= n
            %dt Correct predictions:
            %dd
              =# sprintf("%.2f", v[:classification_statistics][:percent_correct].to_f)
              = sprintf("%.2f", 100*(tp+tn).to_f/n)
              = '%'
            %dt
              %a{:href => "http://en.wikipedia.org/wiki/Receiver_operating_characteristic", :target => "_blank"} Weighted area under ROC:
            %dd 
              = sprintf("%.3f", v[:classification_statistics][:weighted_area_under_roc].to_f)
            %dt
              %a{:href => "http://en.wikipedia.org/wiki/Sensitivity_and_specificity", :target => "_blank"} Specificity:
            %dd= sprintf("%.3f", tn.to_f/(tn+fp))
            %dt
              %a{:href => "http://en.wikipedia.org/wiki/Sensitivity_and_specificity", :target => "_blank"} Sensitivity:
            %dd= sprintf("%.3f", tp.to_f/(tp+fn))
            %dt
              %a{:href => "http://en.wikipedia.org/wiki/Confusion_matrix", :target => "_blank"} Confusion Matrix:
            %dd
              %table
                %tr
                  %th
                  %th Measured
                %tr
                  %th Predicted
                  %th active
                  %th inactive
                %tr
                  %th active
                  %td= tp
                  %td= fp
                %tr
                  %th inactive
                  %td= fn
                  %td= tn
        - else
          = image_tag("/snake_transparent.gif") if model.validation_status == "Running"
          %a{:href => model.validation_task_uri} #{model.validation_status}